<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itda.ITDA.mybatis.mapper.AdminMapper">
	<select id="getFAQList" parameterType="java.util.Map" resultType="AdminBoard">
		select * 
		from (select rownum rnum, b.*
			  from (select *
			  		from adminboard
			  		where key = 'FAQ'
					order by adNum desc
			  ) b
			  where rownum &lt;= #{end}
		)
		where rnum &gt;= #{start} and rnum &lt;= #{end}
	</select>
	
	<select id="getFAQListCount" resultType="int">
		select count(*) from adminboard where key = 'FAQ'
	</select>
	
	<select id="getFAQDetail" parameterType="int" resultType="AdminBoard">
		select * from adminboard
		where adNum = #{adNum}
	</select>
	
	<insert id="insertFAQ" parameterType="AdminBoard">
		INSERT INTO adminboard
	    (adNum, userId, adWriter, adPassword, adTitle,
	     adContent, adView, QcateId, adDate, adUpdate, key)
	    VALUES (ADMINBOARD_SEQ.nextval, 'system', #{adWriter}, #{adPassword}, #{adTitle},
	     #{adContent}, 0, #{QcateId}, SYSDATE, null, 'FAQ')
	</insert>
	
	<update id="FAQModify" parameterType="AdminBoard">
		update adminboard
		set adTitle = #{adTitle}, adContent = #{adContent}, QcateId = #{QcateId}
		where adNum = #{adNum}
	</update>
	
	<select id="isadWriter" parameterType="Map" resultType="AdminBoard">
		select adNum, adPassword from adminboard
		where adNum = #{num}					<!-- BoardServiceImpl에서 put으로 설정해놓은 이름 -->
		and adPassword = #{pass}
	</select>
	
	<select id="getQNAList" parameterType="java.util.Map" resultType="AdminBoard">
		select * 
		from (select rownum rnum, b.*
			  from (select *
			  		from adminboard
			  		where key = 'QNA'
					order by adNum desc
			  ) b
			  where rownum &lt;= #{end}
		)
		where rnum &gt;= #{start} and rnum &lt;= #{end}
	</select>
	
	<select id="getQNAListCount" resultType="int">
		select count(*) from adminboard where key = 'QNA'
	</select>
	
	<select id="getQnaReplyList" parameterType="map" resultType="QnaReply">
		select * from(select rownum rnum, q.*
					  from( select qnaReplyNum, adNum, adminId,
					  	    qnaReplyContent, qnaReplyDate, qnaReplyUpdate
							from QNAREPLY
							where adNum = #{adNum}
							and qnaReplyState = 'Y'
							order by qnaReplyNum desc
						  ) q
					  where rownum &lt;= #{end}
					  )
		where rnum between #{start} and #{end}
	</select>
	
	<select id="getQnaReplyListCount" resultType="int" parameterType="int">
		select count(*) from QNAREPLY
		where adNum = #{adNum}
		and qnaReplyState = 'Y' 
	</select>
	
	<insert id="QnaReplyInsert" parameterType="QnaReply">
		insert into QNAREPLY
		values(QNAREPLY_SEQ.nextval, #{adNum}, #{adminId}, #{qnaReplyContent},
		SYSDATE, null, 'Y')
	</insert>
	
	<update id="QnaReplyUpdate" parameterType="QnaReply">
		update QNAREPLY
		set qnaReplyContent = #{qnaReplyContent}
		where qnaReplyNum = #{qnaReplyNum}
	</update>
	
	<update id="QnaReplyDelete" parameterType="QnaReply">
		update QNAREPLY
		set qnaReplyState = 'N'
		where qnaReplyNum = #{qnaReplyNum}
	</update>
</mapper>